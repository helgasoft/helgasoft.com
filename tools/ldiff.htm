<html>
<head>
  <meta charset="utf-8">
  <title>Compare Lists</title>
  <style>
	body {
    		font: normal 16px Calibri, Verdana, Arial, sans-serif;
	}
	.txt {font-size:small}
  </style>
  <script type="text/javascript">

function compir() {
	// TODO: sort option, processing msg
	//http://stackoverflow.com/questions/21987909/difference-between-two-array-of-objects-in-javascript
 	//window.performance.mark('mark_start);
	var startTime = Date.now();
	var timer = document.getElementById("timer");

	var result1 = document.getElementById("TextBox1").value.replace(/\r\n/g,"\n").split("\n");
	var result2 = document.getElementById("TextBox2").value.replace(/\r\n/g,"\n").split("\n");
	var dup1, dup2;

	// trim all string elements
	//result1.map(function(s) { return String.prototype.trim.apply(s); });
	//result2.map(function(s) { return String.prototype.trim.apply(s); });

	if (document.getElementById("nodup").checked) {
		//remove duplicates first
		result1 = result1.filter(function(item, pos, self) {
		    return self.indexOf(item) == pos;
		})
		result2 = result2.filter(function(item, pos, self) {
		    return self.indexOf(item) == pos;
		})
	} 
	//find duplicates always
	dup1 = result1.filter(function(item, pos, self) {
	    return self.indexOf(item) != pos;
	})
	dup2 = result2.filter(function(item, pos, self) {
	    return self.indexOf(item) != pos;
	})
	
	//Find values that are in result1 but not in result2
	var uniqueResultOne = result1.filter(function(obj) {
	    return !result2.some(function(obj2) {
	        return obj == obj2;
	    });
	});

	//Find values that are in result2 but not in result1
	var uniqueResultTwo = result2.filter(function(obj) {
	    return !result1.some(function(obj2) {
	        return obj == obj2;
	    });
	});
	
	//Find values that are both in result2 and result1
	var commonResult = result2.filter(function(obj) {
	    return result1.some(function(obj2) {
	        return obj == obj2;
	    });
	});
	
	document.getElementById("uniq1").value = uniqueResultOne.join('\n');
	document.getElementById("uniq2").value = uniqueResultTwo.join('\n');
	document.getElementById("common").value = commonResult.join('\n');
	leni(document.getElementById("uniq1"), 'lbl3');
	leni(document.getElementById("uniq2"), 'lbl4');
	leni(document.getElementById("common"), 'lbl5');
	document.getElementById("dupl1").value = dup1.join('\n');
	document.getElementById("dupl2").value = dup2.join('\n');
	leni(document.getElementById("dupl1"), 'lbl6');
	leni(document.getElementById("dupl2"), 'lbl7');

	//Combine the two arrays of unique entries
	//var result = uniqueResultOne.concat(uniqueResultTwo);
	//document.getElementById("lblMsg").innerHTML = result.toString();

   	var ms = Date.now() - startTime; //, min = (ms/1000/60) << 0, sec = (ms/1000) % 60;
	var sec = Math.floor(ms / 1000);
	var min = Math.floor(sec / 60);
	sec = sec - (min * 60);
	timer.innerText = "Finished in " + min + ":" + sec + " (min:sec)";
}
function leni(me,lbl) {
	var text = document.getElementById(me.id).value;
	if (text.length == 0) {
		document.getElementById(lbl).innerText = '(none)';
		return;
	}
	var rows = text.split("\n").length;
	document.getElementById(lbl).innerText = rows + ' items'; //'(' + 
}
  </script>
</head>
<body>

    <div align="center">
        <h3>Compare Lists</h3>
    </div>

    <p>
    <table border='0'>
    <tr><td colspan=3>Paste one-per-line items in both boxes, then Submit</td>
	<td colspan=2><b>Unique</b> items</td>
        <td rowspan=3 style="width:240px;text-align:center;" vAlign="top">
		<b>Common</b> to both<br /><label id="lbl5" class='txt'></label>
		<br /><textarea ID="common" rows=9 cols=20></textarea></td>
	<td colspan=2><b>Duplicate</b> items</td>
	</tr>
    <tr>
        <td align="right">First List<br /><label id="lbl1" class='txt'></label></td>
        <td><textarea ID="TextBox1" rows=4 cols=20 onchange="leni(this,'lbl1')" tabindex=1></textarea></td>
        <td rowspan='2' valign='center'>
       		<div style="width:200px;text-align:center">
			<div class='txt'><input type="checkbox" id='nodup' value='nodup' /> delete duplicates</div>
			<input id="btnSubmit" type='button' value="Submit" onclick='compir();' style="width:90px;" tabindex=3/>
		</div>
	</td>
        <td align="right">in first <br /><label id="lbl3" class='txt'></label></td>
        <td><textarea ID="uniq1" rows=4 cols=20></textarea></td>
        <td align="right">in first <br /><label id="lbl6" class='txt'></label></td>
        <td><textarea ID="dupl1" rows=4 cols=15></textarea></td>
    <tr><td align="right">Second List<br /><label id="lbl2" class='txt'></label></td>
        <td><textarea ID="TextBox2" rows=4 cols=20 onchange="leni(this,'lbl2')" tabindex=2></textarea></td>
        <td align="right">in second<br /><label id="lbl4" class='txt'></label></td>
        <td><textarea ID="uniq2" rows=4 cols=20></textarea>
	<br />	<div id="timer"></div>
	</td>
        <td align="right">in second<br /><label id="lbl7" class='txt'></label></td>
        <td><textarea ID="dupl2" rows=4 cols=15></textarea></td>
    </tr></table>
    </p>
</body>
</html>
